# JWT Аутентификация

## Описание подхода

Эта реализация использует **JWT (JSON Web Token) аутентификацию** - stateless подход, где вся информация о пользователе содержится в самом токене. Сервер не хранит состояние сессий.

### Особенности:
- **Stateless**: сервер не хранит состояние сессий
- **Масштабируемость**: легко масштабируется на множество серверов
- **Refresh токены**: механизм обновления access токенов
- **Самодостаточность**: токен содержит всю необходимую информацию

## Технологии

- **FastAPI** - современный веб-фреймворк с автоматической документацией
- **PyJWT** - работа с JSON Web Tokens
- **bcrypt** - хеширование паролей
- **SQLite** - база данных пользователей и refresh токенов

## Установка и запуск

1. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate     # Windows
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Запустите приложение:
```bash
python main.py
```

4. Откройте браузер: http://localhost:8000
5. API документация: http://localhost:8000/docs

## Использование

### Веб-интерфейс
Откройте http://localhost:8000 в браузере и используйте формы для:
- Регистрации нового пользователя
- Входа в систему (получение токенов)
- Просмотра профиля (с access токеном)
- Обновления токена (с refresh токеном)
- Выхода из системы (отзыв refresh токена)

### API через curl

#### Регистрация:
```bash
curl -X POST http://localhost:8000/register \
  -H "Content-Type: application/json" \
  -d '{"email": "user@example.com", "password": "password123"}'
```

#### Вход:
```bash
curl -X POST http://localhost:8000/login \
  -H "Content-Type: application/json" \
  -d '{"email": "user@example.com", "password": "password123"}'
```

Ответ:
```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "refresh_token": "abc123def456...",
  "token_type": "bearer"
}
```

#### Профиль (требует access токен):
```bash
curl http://localhost:8000/profile \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

#### Обновление токена:
```bash
curl -X POST http://localhost:8000/refresh \
  -H "Content-Type: application/json" \
  -d '{"refresh_token": "YOUR_REFRESH_TOKEN"}'
```

#### Выход (отзыв refresh токена):
```bash
curl -X POST http://localhost:8000/logout \
  -H "Content-Type: application/json" \
  -d '{"refresh_token": "YOUR_REFRESH_TOKEN"}'
```

## Безопасность

- **Хеширование паролей**: bcrypt с солью
- **JWT подпись**: токены подписываются секретным ключом
- **Время жизни токенов**: access токен - 30 минут, refresh токен - 7 дней
- **Типы токенов**: различение access и refresh токенов
- **Отзыв токенов**: возможность отозвать refresh токены
- **Валидация**: проверка email и длины пароля

## Архитектура

```
Клиент (Браузер/Мобильное приложение)
    ↓ HTTP запросы с Bearer токеном
FastAPI приложение
    ↓ проверка JWT токена
SQLite (пользователи + refresh токены)
```

## Преимущества JWT аутентификации

1. **Stateless**: сервер не хранит состояние
2. **Масштабируемость**: легко масштабируется горизонтально
3. **Производительность**: нет дополнительных запросов к БД для проверки сессий
4. **Кроссплатформенность**: работает с любыми клиентами
5. **Самодостаточность**: токен содержит всю необходимую информацию

## Недостатки

1. **Отзыв токенов**: сложнее отозвать токен до истечения срока
2. **Размер токена**: JWT больше обычных session ID
3. **Безопасность**: токены хранятся на клиенте
4. **Обновление данных**: изменения в пользователе не отражаются в токене

## Структура JWT токена

JWT состоит из трех частей, разделенных точками:
- **Header**: алгоритм подписи
- **Payload**: данные пользователя и метаданные
- **Signature**: подпись для проверки целостности

Пример payload:
```json
{
  "sub": 1,
  "exp": 1703123456,
  "type": "access"
}
```

## Refresh Token механизм

1. При входе выдаются access и refresh токены
2. Access токен имеет короткое время жизни (30 минут)
3. Refresh токен имеет длительное время жизни (7 дней)
4. Для получения нового access токена используется refresh токен
5. Refresh токен можно отозвать при выходе
