# JWT –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è - –ü–æ–ª–Ω–æ–µ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∏-–ø—Ä–∏–Ω—Ü–∏–ø—ã-—Ä–∞–±–æ—Ç—ã)
3. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–∑–∞–ø—É—Å–∫)
4. [–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–æ–¥–∞](#–¥–µ—Ç–∞–ª—å–Ω–æ–µ-–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ-–∫–æ–¥–∞)
5. [API Endpoints](#api-endpoints)
6. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
7. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
8. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ-–≤-–ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)

## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ JWT —Ç–æ–∫–µ–Ω–æ–≤**, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º FastAPI. –°–∏—Å—Ç–µ–º–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ stateless –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –≤–∫–ª—é—á–∞–µ—Ç:

- ‚úÖ **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **Access –∏ Refresh —Ç–æ–∫–µ–Ω—ã** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- ‚úÖ **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ **REST API** –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** FastAPI
- ‚úÖ **–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏** –∫ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ –∫–æ–¥–∞

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã

### JWT (JSON Web Token) - —á—Ç–æ —ç—Ç–æ?

JWT - —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ –≤ –≤–∏–¥–µ JSON –æ–±—ä–µ–∫—Ç–∞. –¢–æ–∫–µ–Ω —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ—Ö —á–∞—Å—Ç–µ–π, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–æ—á–∫–∞–º–∏:

```
header.payload.signature
```

**–ü—Ä–∏–º–µ—Ä JWT —Ç–æ–∫–µ–Ω–∞:**
```
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOjEsInR5cGUiOiJhY2Nlc3MiLCJleHAiOjE2OTk5OTk5OTl9.signature_hash
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend      ‚îÇ    ‚îÇ   FastAPI       ‚îÇ    ‚îÇ   SQLite DB     ‚îÇ
‚îÇ   (HTML/JS)     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   Backend       ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (Users +      ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ    Tokens)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ
         ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Browser       ‚îÇ    ‚îÇ   JWT Tokens    ‚îÇ
‚îÇ   Storage       ‚îÇ    ‚îÇ   (Access +     ‚îÇ
‚îÇ   (LocalStorage)‚îÇ    ‚îÇ    Refresh)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –∞–∫–∫–∞—É–Ω—Ç ‚Üí –ø–∞—Ä–æ–ª—å —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
2. **–í—Ö–æ–¥**: –ü—Ä–æ–≤–µ—Ä–∫–∞ email/–ø–∞—Ä–æ–ª—è ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ access + refresh —Ç–æ–∫–µ–Ω–æ–≤ ‚Üí –≤–æ–∑–≤—Ä–∞—Ç —Ç–æ–∫–µ–Ω–æ–≤
3. **–î–æ—Å—Ç—É–ø –∫ API**: –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç access —Ç–æ–∫–µ–Ω ‚Üí —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å ‚Üí –¥–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω
4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞**: Access —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ ‚Üí –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç refresh —Ç–æ–∫–µ–Ω ‚Üí –Ω–æ–≤—ã–π access —Ç–æ–∫–µ–Ω

### –¢–∏–ø—ã —Ç–æ–∫–µ–Ω–æ–≤

#### Access Token (–ö–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–π)
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏**: 30 –º–∏–Ω—É—Ç
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –î–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º
- **–°–æ–¥–µ—Ä–∂–∏—Ç**: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ç–∏–ø —Ç–æ–∫–µ–Ω–∞, –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è
- **–•—Ä–∞–Ω–∏—Ç—Å—è**: –í –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (JavaScript)

#### Refresh Token (–î–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π)
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏**: 7 –¥–Ω–µ–π
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access —Ç–æ–∫–µ–Ω–æ–≤
- **–°–æ–¥–µ—Ä–∂–∏—Ç**: –°–ª—É—á–∞–π–Ω—É—é —Å—Ç—Ä–æ–∫—É (—Ö–µ—à–∏—Ä—É–µ—Ç—Å—è –≤ –ë–î)
- **–•—Ä–∞–Ω–∏—Ç—Å—è**: –í –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞ + —Ö–µ—à –≤ –ë–î

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.8+
- pip (–º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤ Python)

### –ü–æ—à–∞–≥–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# 1. –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd Primer_auth/jwt_auth

# 2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python -m venv venv

# 3. –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# 5. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
python main.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
- **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞**: http://localhost:8000
- **API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: http://localhost:8000/docs
- **–¢–µ—Å—Ç JavaScript**: http://localhost:8000/test-js

## üîç –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–æ–¥–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞ main.py

```python
# 1. –ò–ú–ü–û–†–¢–´ –ò –ù–ê–°–¢–†–û–ô–ö–ò
# 2. PYDANTIC –°–•–ï–ú–´ –î–ê–ù–ù–´–•
# 3. –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–´ –° –ë–ê–ó–û–ô –î–ê–ù–ù–´–•
# 4. –§–£–ù–ö–¶–ò–ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò –ò –•–ï–®–ò–†–û–í–ê–ù–ò–Ø
# 5. –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–´ –° JWT –¢–û–ö–ï–ù–ê–ú–ò
# 6. –ó–ê–í–ò–°–ò–ú–û–°–¢–ò –ò MIDDLEWARE
# 7. HTML –ò–ù–¢–ï–†–§–ï–ô–°
# 8. API ENDPOINTS
# 9. –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
```

### 1. –ò–º–ø–æ—Ä—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```python
# FastAPI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
from fastapi import FastAPI, HTTPException, Depends, status
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from fastapi.responses import HTMLResponse
from fastapi.staticfiles import StaticFiles

# –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
from pydantic import BaseModel, EmailStr

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ JWT
import jwt  # PyJWT –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–∫–µ–Ω–∞–º–∏
import bcrypt  # –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
import secrets  # –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å—Ç–æ–π–∫–∏–µ —Å–ª—É—á–∞–π–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –≤—Ä–µ–º—è
import sqlite3
from datetime import datetime, timedelta
from typing import Optional
```

### 2. Pydantic —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö

```python
class UserRegister(BaseModel):
    """–°—Ö–µ–º–∞ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    email: EmailStr  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è email
    password: str    # –ü–∞—Ä–æ–ª—å (–±—É–¥–µ—Ç –∑–∞—Ö–µ—à–∏—Ä–æ–≤–∞–Ω)

class UserLogin(BaseModel):
    """–°—Ö–µ–º–∞ –¥–ª—è –≤—Ö–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    email: EmailStr
    password: str

class Token(BaseModel):
    """–û—Ç–≤–µ—Ç —Å —Ç–æ–∫–µ–Ω–∞–º–∏ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞"""
    access_token: str   # –ö–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–π —Ç–æ–∫–µ–Ω
    refresh_token: str  # –î–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π —Ç–æ–∫–µ–Ω
    token_type: str     # –¢–∏–ø —Ç–æ–∫–µ–Ω–∞ ("bearer")
```

### 3. –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

#### init_db() - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
```python
def init_db():
    """–°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã users –∏ refresh_tokens"""
    conn = sqlite3.connect('jwt_users.db')
    cursor = conn.cursor()
    
    # –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS users (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            email TEXT UNIQUE NOT NULL,
            password_hash TEXT NOT NULL,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ''')
    
    # –¢–∞–±–ª–∏—Ü–∞ refresh —Ç–æ–∫–µ–Ω–æ–≤
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS refresh_tokens (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER NOT NULL,
            token_hash TEXT NOT NULL,
            expires_at TIMESTAMP NOT NULL,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY (user_id) REFERENCES users (id)
        )
    ''')
    
    conn.commit()
    conn.close()
```

#### get_user_by_email() - –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```python
def get_user_by_email(email: str) -> Optional[tuple]:
    """–ü–æ–ª—É—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email –∏–∑ –ë–î"""
    conn = sqlite3.connect('jwt_users.db')
    cursor = conn.cursor()
    cursor.execute('SELECT id, email, password_hash, created_at FROM users WHERE email = ?', (email,))
    user = cursor.fetchone()  # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ç–µ–∂ –∏–ª–∏ None
    conn.close()
    return user
```

#### create_user() - –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```python
def create_user(email: str, password: str) -> Optional[int]:
    """–°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î"""
    password_hash = hash_password(password)  # –•–µ—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å
    conn = sqlite3.connect('jwt_users.db')
    cursor = conn.cursor()
    try:
        cursor.execute('INSERT INTO users (email, password_hash) VALUES (?, ?)', 
                      (email, password_hash))
        conn.commit()
        user_id = cursor.lastrowid  # ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        conn.close()
        return user_id
    except sqlite3.IntegrityError:  # Email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        conn.close()
        return None
```

### 4. –§—É–Ω–∫—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### hash_password() - –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è
```python
def hash_password(password: str) -> str:
    """–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å bcrypt"""
    salt = bcrypt.gensalt()  # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Å–æ–ª—å
    return bcrypt.hashpw(password.encode('utf-8'), salt).decode('utf-8')
```

#### verify_password() - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
```python
def verify_password(password: str, password_hash: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è –ø—Ä–æ—Ç–∏–≤ —Ö–µ—à–∞"""
    return bcrypt.checkpw(password.encode('utf-8'), password_hash.encode('utf-8'))
```

### 5. –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å JWT —Ç–æ–∫–µ–Ω–∞–º–∏

#### create_access_token() - –°–æ–∑–¥–∞–Ω–∏–µ access —Ç–æ–∫–µ–Ω–∞
```python
def create_access_token(data: dict, expires_delta: Optional[timedelta] = None):
    """–°–æ–∑–¥–∞–µ—Ç JWT access —Ç–æ–∫–µ–Ω"""
    to_encode = data.copy()  # –ö–æ–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è –∏ —Ç–∏–ø —Ç–æ–∫–µ–Ω–∞
    to_encode.update({"exp": expire, "type": "access"})
    
    # –ö–æ–¥–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω —Å —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º
    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)
    return encoded_jwt
```

#### create_refresh_token() - –°–æ–∑–¥–∞–Ω–∏–µ refresh —Ç–æ–∫–µ–Ω–∞
```python
def create_refresh_token(user_id: int) -> str:
    """–°–æ–∑–¥–∞–µ—Ç refresh —Ç–æ–∫–µ–Ω –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ —Ö–µ—à –≤ –ë–î"""
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å—Ç–æ–π–∫—É—é —Å–ª—É—á–∞–π–Ω—É—é —Å—Ç—Ä–æ–∫—É
    token = secrets.token_urlsafe(32)
    token_hash = hash_password(token)  # –•–µ—à–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
    conn = sqlite3.connect('jwt_users.db')
    cursor = conn.cursor()
    expires_at = datetime.utcnow() + timedelta(days=REFRESH_TOKEN_EXPIRE_DAYS)
    cursor.execute('''
        INSERT INTO refresh_tokens (user_id, token_hash, expires_at) 
        VALUES (?, ?, ?)
    ''', (user_id, token_hash, expires_at))
    conn.commit()
    conn.close()
    
    return token  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω (–Ω–µ —Ö–µ—à)
```

#### verify_refresh_token() - –ü—Ä–æ–≤–µ—Ä–∫–∞ refresh —Ç–æ–∫–µ–Ω–∞
```python
def verify_refresh_token(token: str) -> Optional[int]:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç refresh —Ç–æ–∫–µ–Ω –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç user_id"""
    conn = sqlite3.connect('jwt_users.db')
    cursor = conn.cursor()
    
    # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ refresh —Ç–æ–∫–µ–Ω—ã
    cursor.execute('''
        SELECT user_id, token_hash FROM refresh_tokens 
        WHERE expires_at > datetime('now')
    ''')
    tokens = cursor.fetchall()
    conn.close()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω –ø—Ä–æ—Ç–∏–≤ –≤—Å–µ—Ö —Ö–µ—à–µ–π
    for user_id, token_hash in tokens:
        if verify_password(token, token_hash):
            return user_id
    
    return None  # –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –∏—Å—Ç–µ–∫
```

### 6. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ middleware

#### get_current_user() - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
```python
def get_current_user(credentials: HTTPAuthorizationCredentials = Depends(security)):
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞"""
    try:
        token = credentials.credentials  # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])  # –î–µ–∫–æ–¥–∏—Ä—É–µ–º
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ç–æ–∫–µ–Ω–∞
        if payload.get("type") != "access":
            raise HTTPException(status_code=401, detail="Invalid token type")
        
        user_id: int = payload.get("sub")  # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        if user_id is None:
            raise HTTPException(status_code=401, detail="Invalid token")
        
        return user_id
    except jwt.PyJWTError:  # –û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
        raise HTTPException(status_code=401, detail="Invalid token")
```

## üì° API Endpoints

### POST /register
**–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

```python
@app.post("/register", response_model=dict)
def register(user: UserRegister):
    """–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    print(f"Register request received: email={user.email}, password_length={len(user.password)}")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –ø–∞—Ä–æ–ª—è
    if len(user.password) < 6:
        raise HTTPException(status_code=400, detail="–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤")
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user_id = create_user(user.email, user.password)
    if user_id is None:
        raise HTTPException(status_code=400, detail="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
    
    return {"message": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω"}
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X POST http://localhost:8000/register \
  -H "Content-Type: application/json" \
  -d '{"email": "user@example.com", "password": "password123"}'
```

### POST /login
**–í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º—É**

```python
@app.post("/login", response_model=Token)
def login(user: UserLogin):
    """–í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    print(f"Login request received: email={user.email}, password_length={len(user.password)}")
    
    # –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user_data = get_user_by_email(user.email)
    if not user_data:
        raise HTTPException(status_code=401, detail="–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å")
    
    user_id, user_email, password_hash, created_at = user_data
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
    if not verify_password(user.password, password_hash):
        raise HTTPException(status_code=401, detail="–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å")
    
    # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
    access_token = create_access_token(data={"sub": user_id})
    refresh_token = create_refresh_token(user_id)
    
    return {
        "access_token": access_token,
        "refresh_token": refresh_token,
        "token_type": "bearer"
    }
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X POST http://localhost:8000/login \
  -H "Content-Type: application/json" \
  -d '{"email": "user@example.com", "password": "password123"}'
```

### POST /refresh
**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access —Ç–æ–∫–µ–Ω–∞**

```python
@app.post("/refresh", response_model=Token)
def refresh_token(token_data: TokenRefresh):
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access —Ç–æ–∫–µ–Ω–∞"""
    user_id = verify_refresh_token(token_data.refresh_token)
    if user_id is None:
        raise HTTPException(status_code=401, detail="–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π refresh —Ç–æ–∫–µ–Ω")
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ access —Ç–æ–∫–µ–Ω–∞
    access_token = create_access_token(data={"sub": user_id})
    
    return {
        "access_token": access_token,
        "refresh_token": token_data.refresh_token,  # Refresh —Ç–æ–∫–µ–Ω –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ—Ç –∂–µ
        "token_type": "bearer"
    }
```

### GET /profile
**–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ (–∑–∞—â–∏—â–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç)**

```python
@app.get("/profile", response_model=UserResponse)
def get_profile(current_user: int = Depends(get_current_user)):
    """–ó–∞—â–∏—â—ë–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –ø—Ä–æ—Ñ–∏–ª—è"""
    conn = sqlite3.connect('jwt_users.db')
    cursor = conn.cursor()
    cursor.execute('SELECT id, email, created_at FROM users WHERE id = ?', (current_user,))
    user = cursor.fetchone()
    conn.close()
    
    if not user:
        raise HTTPException(status_code=404, detail="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω")
    
    user_id, email, created_at = user
    return UserResponse(id=user_id, email=email, created_at=created_at)
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl http://localhost:8000/profile \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

### POST /logout
**–í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã (–æ—Ç–∑—ã–≤ refresh —Ç–æ–∫–µ–Ω–∞)**

```python
@app.post("/logout", response_model=dict)
def logout(token_data: TokenRefresh):
    """–í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã (–æ—Ç–∑—ã–≤ refresh —Ç–æ–∫–µ–Ω–∞)"""
    revoke_refresh_token(token_data.refresh_token)
    return {"message": "–í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ"}
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –≤ —Å–∏—Å—Ç–µ–º–µ:

#### 1. –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- **–ê–ª–≥–æ—Ä–∏—Ç–º**: bcrypt —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–æ–ª—å—é
- **–ó–∞—â–∏—Ç–∞**: –û—Ç rainbow tables –∏ dictionary attacks
- **–í—Ä–µ–º—è**: –ö–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–µ –≤—Ä–µ–º—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (–∑–∞—â–∏—Ç–∞ –æ—Ç timing attacks)

#### 2. JWT —Ç–æ–∫–µ–Ω—ã
- **–ü–æ–¥–ø–∏—Å—å**: HMAC-SHA256 —Å —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏**: –ö–æ—Ä–æ—Ç–∫–∏–µ access —Ç–æ–∫–µ–Ω—ã (30 –º–∏–Ω) + –¥–ª–∏–Ω–Ω—ã–µ refresh —Ç–æ–∫–µ–Ω—ã (7 –¥–Ω–µ–π)
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ user_id)

#### 3. Refresh —Ç–æ–∫–µ–Ω—ã
- **–•—Ä–∞–Ω–µ–Ω–∏–µ**: –•–µ—à –≤ –ë–î, –æ—Ä–∏–≥–∏–Ω–∞–ª —É –∫–ª–∏–µ–Ω—Ç–∞
- **–û—Ç–∑—ã–≤**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–∑—ã–≤–∞ —á–µ—Ä–µ–∑ –ë–î
- **–û—á–∏—Å—Ç–∫–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤

#### 4. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **Pydantic**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- **Email**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ email –∞–¥—Ä–µ—Å–æ–≤
- **–ü–∞—Ä–æ–ª–∏**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ—Ç—É

#### 5. –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫
- **SQL Injection**: –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- **XSS**: –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- **CSRF**: Stateless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–Ω–µ—Ç cookies)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:

```python
# 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
import os
SECRET_KEY = os.getenv("SECRET_KEY", "fallback-key")

# 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS
# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

# 3. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–æ–≤
ACCESS_TOKEN_EXPIRE_MINUTES = 15  # –ï—â–µ –∫–æ—Ä–æ—á–µ
REFRESH_TOKEN_EXPIRE_DAYS = 1     # –ö–æ—Ä–æ—á–µ

# 4. –î–æ–±–∞–≤—å—Ç–µ rate limiting
from slowapi import Limiter
limiter = Limiter(key_func=get_remote_address)

@app.post("/login")
@limiter.limit("5/minute")  # –ú–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–æ–∫ –≤ –º–∏–Ω—É—Ç—É
def login(request: Request, user: UserLogin):
    # ...
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å
5. –û–±–Ω–æ–≤–∏—Ç–µ —Ç–æ–∫–µ–Ω
6. –í—ã–π–¥–∏—Ç–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

### API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å curl

```bash
# 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
curl -X POST http://localhost:8000/register \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com", "password": "testpass123"}'

# 2. –í—Ö–æ–¥
curl -X POST http://localhost:8000/login \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com", "password": "testpass123"}'

# 3. –ü—Ä–æ—Ñ–∏–ª—å (–∑–∞–º–µ–Ω–∏—Ç–µ YOUR_TOKEN –Ω–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π access_token)
curl http://localhost:8000/profile \
  -H "Authorization: Bearer YOUR_TOKEN"

# 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (–∑–∞–º–µ–Ω–∏—Ç–µ YOUR_REFRESH_TOKEN)
curl -X POST http://localhost:8000/refresh \
  -H "Content-Type: application/json" \
  -d '{"refresh_token": "YOUR_REFRESH_TOKEN"}'

# 5. –í—ã—Ö–æ–¥
curl -X POST http://localhost:8000/logout \
  -H "Content-Type: application/json" \
  -d '{"refresh_token": "YOUR_REFRESH_TOKEN"}'
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ JavaScript
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000/test-js
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –∫–Ω–æ–ø–∫–∏
3. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ JavaScript

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# .env —Ñ–∞–π–ª
SECRET_KEY=your-super-secret-key-here
DATABASE_URL=postgresql://user:password@localhost/dbname
REDIS_URL=redis://localhost:6379
```

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```python
# –ó–∞–º–µ–Ω–∏—Ç–µ SQLite –Ω–∞ PostgreSQL
import psycopg2
from sqlalchemy import create_engine

DATABASE_URL = os.getenv("DATABASE_URL")
engine = create_engine(DATABASE_URL)
```

### 3. HTTPS –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
```python
# –î–æ–±–∞–≤—å—Ç–µ middleware –¥–ª—è HTTPS
from fastapi.middleware.httpsredirect import HTTPSRedirectMiddleware
app.add_middleware(HTTPSRedirectMiddleware)

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ CORS
from fastapi.middleware.cors import CORSMiddleware
app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://yourdomain.com"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
import logging
from fastapi import Request
import time

@app.middleware("http")
async def log_requests(request: Request, call_next):
    start_time = time.time()
    response = await call_next(request)
    process_time = time.time() - start_time
    
    logging.info(f"{request.method} {request.url} - {response.status_code} - {process_time:.3f}s")
    return response
```

### 5. Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
```dockerfile
# Dockerfile
FROM python:3.9-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .
EXPOSE 8000

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [JWT.io](https://jwt.io/) - –û—Ç–ª–∞–¥–∫–∞ JWT —Ç–æ–∫–µ–Ω–æ–≤
- [FastAPI Security](https://fastapi.tiangolo.com/tutorial/security/) - –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [OWASP Authentication Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html)
- [bcrypt](https://pypi.org/project/bcrypt/) - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- [PyJWT](https://pyjwt.readthedocs.io/) - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è JWT –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–µ–∫—Ç:

1. –°–æ–∑–¥–∞–π—Ç–µ fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
4. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è —Å–≤–æ–±–æ–¥–Ω–æ.

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–ª–µ–¥—É–π—Ç–µ –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.